{% extends 'base.html.twig' %}

{% block title %}{{ module.title }} — ModuleQuizzer{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/">Courses</a></li>
    <li class="breadcrumb-item">
      <a href="/course/{{ course.course_id }}">{{ course.title }}</a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">{{ module.title }}</li>
  </ol>
</nav>

<div class="d-flex justify-content-between align-items-start mb-3">
  <h1>{{ module.title }}</h1>
  <div class="btn-group">
    <a href="/module/{{ module.module_id }}/edit"
       class="btn btn-sm btn-outline-secondary">Edit Module</a>
    <form method="post" action="/module/{{ module.module_id }}/delete"
          class="d-inline"
          onsubmit="return confirm('Delete this module and all its content?');">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
    </form>
  </div>
</div>

{# ── Lesson Card ─────────────────────────────────────── #}
<section class="card mb-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h2 class="h5 mb-0">Lesson</h2>
    <a href="/module/{{ module.module_id }}/lesson" class="btn btn-sm btn-outline-primary">
      {{ lesson ? 'Edit' : 'Create' }} Lesson
    </a>
  </div>
  <div class="card-body">
    {% if lesson %}
      {# SAFE: lesson HTML authored by the application administrator #}
      {{ lesson.content_html|raw }}
    {% else %}
      <p class="text-muted mb-0">No lesson has been created yet.</p>
    {% endif %}
  </div>
</section>

{# ── Questions Card ──────────────────────────────────── #}
<section class="card mb-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h2 class="h5 mb-0">Questions ({{ questions|length }})</h2>
    <a href="/module/{{ module.module_id }}/question/create"
       class="btn btn-sm btn-outline-primary">+ Add Question</a>
  </div>
  <div class="card-body">
    {% if questions|length > 0 %}
      <div class="list-group list-group-flush">
        {% for q in questions %}
          <div class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <span class="badge bg-info text-dark me-2">
                {{ q.question_type|replace({'_': ' '})|capitalize }}
              </span>
              {{ q.prompt|slice(0, 80) }}{% if q.prompt|length > 80 %}&hellip;{% endif %}
            </div>
            <div class="btn-group btn-group-sm">
              <a href="/question/{{ q.question_id }}/edit"
                 class="btn btn-outline-secondary">Edit</a>
              <form method="post" action="/question/{{ q.question_id }}/delete"
                    class="d-inline"
                    onsubmit="return confirm('Delete this question?');">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-outline-danger">Delete</button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-muted mb-0">No questions yet.</p>
    {% endif %}
  </div>
</section>

{% if questions|length > 0 %}
  <a href="/module/{{ module.module_id }}/quiz"
     class="btn btn-primary btn-lg">Take Quiz</a>
{% endif %}
{% endblock %}
